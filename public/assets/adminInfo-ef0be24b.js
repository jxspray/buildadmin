import{d as D,C as G,y as P,a as g,s as U,e as o,b as i,v as u,Q as p,u as t,c as w,a4 as V,a3 as F,R as k,as as H,T as J,V as W,U as Y,r,X as Z}from"./vue-9a46e809.js";import{a as ee}from"./index-ae07247d.js";import{f as y,p as ae,w as oe,K as ne}from"./common-535f3731.js";import{c as te}from"./controllerUrls-941681c3.js";import{u as z}from"./random-1d7fa280.js";import{b}from"./validate-61c16ed0.js";import{t as le}from"./index-01bed986.js";import{_ as ie}from"./_plugin-vue_export-helper-c27b6911.js";const S="/admin/routine.AdminInfo/",x=new Map([["index",S+"index"],["edit",S+"edit"],["log",te+"index"]]);function de(){return y({url:x.get("index"),method:"get"})}function re(_={}){return y({url:x.get("log"),method:"get",params:_})}function K(_){return y({url:x.get("edit"),method:"post",data:_},{showSuccessMessage:!0})}const me={class:"default-main"},se={class:"admin-info"},ue={class:"image-slot"},fe={class:"admin-info-base"},pe={class:"admin-nickname"},ce={class:"admin-other"},ge={class:"admin-info-form"},_e=D({name:"routine/adminInfo"}),Ie=D({..._e,setup(_){const{t:n}=ee(),c=G(),I=ae(),e=P({adminInfo:{},formKey:z(),buttonLoading:!1,log:[],logFilter:{limit:12},logCurrentPage:1,logPageSize:12,logTotal:100,logLoading:!0});de().then(d=>{e.adminInfo=d.data.info,e.formKey=z(),e.logFilter.search=[{field:"admin_id",val:d.data.info.id,operator:"="}],v()});const v=()=>{re(e.logFilter).then(d=>{e.log=d.data.list,e.logTotal=d.data.total,e.logLoading=!1}).catch(()=>{e.logLoading=!1})},T=d=>{e.logPageSize=d,e.logFilter.limit=d,v()},$=d=>{e.logCurrentPage=d,e.logFilter.page=d,v()},A=P({nickname:[b({name:"required",title:n("routine.adminInfo.User nickname")})],email:[b({name:"email",title:n("routine.adminInfo.e-mail address")})],mobile:[b({name:"mobile",message:n("Please enter the correct field",{field:n("routine.adminInfo.phone number")})})],password:[b({name:"password"})]}),B=d=>{let a=new FormData;a.append("file",d.raw),ne(a).then(m=>{m.code==1&&K({id:e.adminInfo.id,avatar:m.data.file.url}).then(()=>{I.dataFill({...I.$state,avatar:m.data.file.full_url}),e.adminInfo.avatar=m.data.file.full_url})})},h=d=>{d&&d.validate(a=>{if(a){let m={...e.adminInfo};delete m.lastlogintime,delete m.username,delete m.avatar,e.buttonLoading=!0,K(m).then(()=>{I.dataFill({...I.$state,nickname:e.adminInfo.nickname}),e.buttonLoading=!1}).catch(()=>{e.buttonLoading=!1})}})};return(d,a)=>{const m=r("Icon"),R=r("el-image"),N=r("el-upload"),f=r("el-input"),s=r("el-form-item"),C=r("el-button"),L=r("el-col"),j=r("el-timeline-item"),M=r("el-timeline"),q=r("el-pagination"),E=r("el-card"),O=r("el-row"),Q=Z("loading");return g(),U("div",me,[o(O,{gutter:30},{default:i(()=>[o(L,{class:"lg-mb-20",xs:24,sm:24,md:24,lg:10},{default:i(()=>[u("div",se,[o(N,{class:"avatar-uploader",action:"","show-file-list":!1,onChange:B,"auto-upload":!1,accept:"image/gif, image/jpg, image/jpeg, image/bmp, image/png, image/webp"},{default:i(()=>[o(R,{src:e.adminInfo.avatar,class:"avatar"},{error:i(()=>[u("div",ue,[o(m,{size:"30",color:"#c0c4cc",name:"el-icon-Picture"})])]),_:1},8,["src"])]),_:1}),u("div",fe,[u("div",pe,p(e.adminInfo.nickname),1),u("div",ce,[u("div",null,p(t(n)("routine.adminInfo.Last logged in on"))+" "+p(e.adminInfo.lastlogintime),1)])]),u("div",ge,[(g(),w(t(H),{onKeyup:a[10]||(a[10]=V(l=>h(c.value),["enter"])),key:e.formKey,"label-position":"top",rules:A,ref_key:"formRef",ref:c,model:e.adminInfo},{default:i(()=>[o(s,{label:t(n)("routine.adminInfo.user name")},{default:i(()=>[o(f,{disabled:"",modelValue:e.adminInfo.username,"onUpdate:modelValue":a[0]||(a[0]=l=>e.adminInfo.username=l)},null,8,["modelValue"])]),_:1},8,["label"]),o(s,{label:t(n)("routine.adminInfo.User nickname"),prop:"nickname"},{default:i(()=>[o(f,{placeholder:t(n)("routine.adminInfo.Please enter a nickname"),modelValue:e.adminInfo.nickname,"onUpdate:modelValue":a[1]||(a[1]=l=>e.adminInfo.nickname=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:t(n)("routine.adminInfo.e-mail address"),prop:"email"},{default:i(()=>[o(f,{placeholder:t(n)("Please input field",{field:t(n)("routine.adminInfo.e-mail address")}),modelValue:e.adminInfo.email,"onUpdate:modelValue":a[2]||(a[2]=l=>e.adminInfo.email=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:t(n)("routine.adminInfo.phone number"),prop:"mobile"},{default:i(()=>[o(f,{placeholder:t(n)("Please input field",{field:t(n)("routine.adminInfo.phone number")}),modelValue:e.adminInfo.mobile,"onUpdate:modelValue":a[3]||(a[3]=l=>e.adminInfo.mobile=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:t(n)("routine.adminInfo.autograph"),prop:"motto"},{default:i(()=>[o(f,{onKeyup:[a[4]||(a[4]=V(F(()=>{},["stop"]),["enter"])),a[5]||(a[5]=V(F(l=>h(c.value),["ctrl"]),["enter"]))],placeholder:t(n)("routine.adminInfo.This guy is lazy and doesn write anything"),type:"textarea",modelValue:e.adminInfo.motto,"onUpdate:modelValue":a[6]||(a[6]=l=>e.adminInfo.motto=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,{label:t(n)("routine.adminInfo.New password"),prop:"password"},{default:i(()=>[o(f,{type:"password",placeholder:t(n)("routine.adminInfo.Please leave blank if not modified"),modelValue:e.adminInfo.password,"onUpdate:modelValue":a[7]||(a[7]=l=>e.adminInfo.password=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),o(s,null,{default:i(()=>[o(C,{type:"primary",loading:e.buttonLoading,onClick:a[8]||(a[8]=l=>h(c.value))},{default:i(()=>[k(p(t(n)("routine.adminInfo.Save changes")),1)]),_:1},8,["loading"]),o(C,{onClick:a[9]||(a[9]=l=>t(oe)(c.value))},{default:i(()=>[k(p(t(n)("Reset")),1)]),_:1})]),_:1})]),_:1},8,["rules","model"]))])])]),_:1}),J((g(),w(L,{xs:24,sm:24,md:24,lg:12},{default:i(()=>[o(E,{header:t(n)("routine.adminInfo.Operation log"),shadow:"never"},{default:i(()=>[o(M,null,{default:i(()=>[(g(!0),U(W,null,Y(e.log,(l,X)=>(g(),w(j,{key:X,size:"large",timestamp:t(le)(l.createtime)},{default:i(()=>[k(p(l.title),1)]),_:2},1032,["timestamp"]))),128))]),_:1}),o(q,{currentPage:e.logCurrentPage,"page-size":e.logPageSize,"page-sizes":[12,22,52,100],background:"",layout:"prev, next, jumper",total:e.logTotal,onSizeChange:T,onCurrentChange:$},null,8,["currentPage","page-size","total"])]),_:1},8,["header"])]),_:1})),[[Q,e.logLoading]])]),_:1})])}}});const Ce=ie(Ie,[["__scopeId","data-v-b17ba511"]]);export{Ce as default};
