import{h as j,w as I,r as J,j as W,E as Y,q as d,o as u,k as f,p as n,P as r,a8 as Z,a9 as G,Z as v,Y as b,O as g,V as F,U as E,W as y,m as N}from"./vue-69ad5a16.js";import{w as Q,c as w}from"./index-32d6febb.js";import{b as C}from"./validate-4db1e214.js";const X=["innerHTML"],P={class:"dialog-footer"},ae=j({__name:"index",props:["modelValue","size"],emits:["update:modelValue"],setup(q,{emit:B}){const U=q,{t:_}=Q(),h=I(),e=J({url:"/admin/cms.api/link",catalogUrl:"/admin/cms.api/catalog",linkForm:{type:"0",value:{}},linkDefault:{type:"0",value:[{},{url:""},{table:"",details:""},{catalog:"",anchor:""}]},valueForm:{},dialog:!1,typeList:["无","自定义链接","详情链接","分类链接"],tableList:[],detailsList:[],catalogList:[],title:"",rules:{}}),k=W({get(){return U.modelValue},set(t){B("update:modelValue",t)}});let x={convert(t,l="pid",m="id"){let i=[];if(!Array.isArray(t))return i;t.forEach(o=>{delete o.children});let c={};return t.forEach(o=>{c[o[m]]=o}),t.forEach(o=>{let s=c[o[l]];s?(s.children||(s.children=[])).push(o):i.push(o)}),i=i.filter(o=>o[l]==0),i},convertString(t,l="pid",m="id",i=0,c="└",o=[]){return t.forEach(function(s){s[l]==i&&(i!=0?s.treeString=c:s.treeString="",o.push(s),x.convertString(t,l,m,s[m],"<span class='el-tree-title'></span>"+c,o))}),o.length===0?t:o}};const A=()=>{e.valueForm=e.linkForm.value[e.linkForm.type],e.dialog=!0},T=()=>{e.dialog=!1},M=(t=void 0)=>{if(t)t.validate(l=>{l&&(L(),k.value=e.linkForm,e.dialog=!1)});else return!1},H=()=>{e.linkForm.type=="3"&&e.catalogList.length==0&&w({url:e.catalogUrl,method:"post",data:{}},{showSuccessMessage:!1}).then(t=>{e.catalogList=x.convertString(t.data)})},$=()=>{e.valueForm=e.linkForm.value[e.linkForm.type];let t={};switch(e.linkForm.type){case"1":t={};break;case"2":t={table:[C({name:"required",title:_("类型")})],details:[C({name:"required",title:_("链接")})]};break;case"3":t={catalog:[C({name:"required",title:_("链接")})]};break}e.rules=t,L(),z()},K=()=>{e.linkForm.type=="2"&&e.tableList.length==0&&w({url:e.url,method:"post",data:{}},{showSuccessMessage:!1}).then(t=>{e.tableList=t.data,e.valueForm=e.linkForm.value[e.linkForm.type]})},V=(t="")=>{e.linkForm.type=="2"&&e.valueForm.table!=""&&w({url:`${e.url}/table/${e.valueForm.table}`,method:"post",data:{keyword:t}},{showSuccessMessage:!1}).then(l=>{e.detailsList=l.data})},L=()=>{switch(e.linkForm.type){case"0":case"1":e.title=e.valueForm.url;break;case"2":e.title=e.valueForm.details!==""?e.valueForm.details.title:"";break;case"3":let t=e.valueForm.catalog!==""?e.valueForm.catalog.title:"";e.title=t+e.valueForm.anchor;break}},z=(t="")=>{H(),K(),V(),t!="load"&&L()};return Y(()=>{e.linkForm=JSON.stringify(k.value)==="{}"||k.value.length===0?e.linkDefault:k.value,$(),z("load")}),(t,l)=>{const m=d("el-input"),i=d("el-radio"),c=d("el-radio-group"),o=d("el-form-item"),s=d("el-option"),S=d("el-select"),O=d("el-form"),D=d("el-button"),R=d("el-dialog");return u(),f(v,null,[n(m,{value:e.title,size:U.size,onClick:A,readonly:!0},null,8,["value","size"]),n(R,{class:"el-link-dialog","close-on-click-modal":!1,"model-value":e.dialog,onClose:T,top:"20px",title:"设置链接",width:"540px","append-to-body":""},{default:r(()=>[n(O,{ref_key:"formRef",ref:h,onSubmit:l[8]||(l[8]=Z(()=>{},["prevent"])),onKeyup:l[9]||(l[9]=G(a=>M(h.value),["enter"])),model:e.valueForm,rules:e.rules,"label-width":"100px"},{default:r(()=>[n(o,{label:"链接类型：",prop:"type"},{default:r(()=>[n(c,{modelValue:e.linkForm.type,"onUpdate:modelValue":l[0]||(l[0]=a=>e.linkForm.type=a),onChange:l[1]||(l[1]=a=>$())},{default:r(()=>[(u(!0),f(v,null,b(e.typeList,(a,p)=>(u(),g(i,{label:String(p),key:p},{default:r(()=>[F(E(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.linkForm.type=="1"?(u(),g(o,{key:0,label:"链接：",prop:"url"},{default:r(()=>[n(m,{modelValue:e.valueForm.url,"onUpdate:modelValue":l[2]||(l[2]=a=>e.valueForm.url=a),placeholder:"请填写链接"},null,8,["modelValue"])]),_:1})):y("",!0),e.linkForm.type=="2"?(u(),f(v,{key:1},[n(o,{label:"类型：",prop:"table"},{default:r(()=>[n(S,{placeholder:"请选择类型",modelValue:e.valueForm.table,"onUpdate:modelValue":l[3]||(l[3]=a=>e.valueForm.table=a),onChange:l[4]||(l[4]=a=>V()),filterable:""},{default:r(()=>[(u(!0),f(v,null,b(e.tableList,(a,p)=>(u(),g(s,{label:a.title,value:a.name,key:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e.valueForm.table!=""?(u(),g(o,{key:0,label:"链接：",prop:"details"},{default:r(()=>[n(S,{"value-key":"id",placeholder:"请选择链接，输入标题远程搜索",modelValue:e.valueForm.details,"onUpdate:modelValue":l[5]||(l[5]=a=>e.valueForm.details=a),"reserve-keyword":"",filterable:"",remote:"","remote-method":V},{default:r(()=>[(u(!0),f(v,null,b(e.detailsList,(a,p)=>(u(),g(s,{key:p,label:a.title,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):y("",!0)],64)):y("",!0),e.linkForm.type=="3"?(u(),f(v,{key:2},[n(o,{label:"分类：",prop:"catalog"},{default:r(()=>[n(S,{modelValue:e.valueForm.catalog,"onUpdate:modelValue":l[6]||(l[6]=a=>e.valueForm.catalog=a),"value-key":"id",placeholder:"请选择分类",filterable:""},{default:r(()=>[(u(!0),f(v,null,b(e.catalogList,(a,p)=>(u(),g(s,{key:p,label:a.title,value:a},{default:r(()=>[N("span",{innerHTML:a.treeString},null,8,X),F(" "+E(a.title),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(o,{label:"锚点：",prop:"anchor"},{default:r(()=>[n(m,{modelValue:e.valueForm.anchor,"onUpdate:modelValue":l[7]||(l[7]=a=>e.valueForm.anchor=a),placeholder:"如：#about"},null,8,["modelValue"])]),_:1})],64)):y("",!0)]),_:1},8,["model","rules"]),N("span",P,[n(D,{size:"small",type:"primary",onClick:l[10]||(l[10]=a=>M(h.value))},{default:r(()=>[F("确定")]),_:1}),n(D,{size:"small",onClick:l[11]||(l[11]=a=>e.dialog=!1)},{default:r(()=>[F("取消")]),_:1})])]),_:1},8,["model-value"])],64)}}});export{ae as _};
