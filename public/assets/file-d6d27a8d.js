import{h as L,ar as P,w as R,r as W,q as c,X as v,o as p,O as f,P as l,_ as $,k as E,V as y,m as o,l as j,z as r,p as s,aC as w,W as x,U as q,a8 as K,a1 as O,a2 as X}from"./vue-69ad5a16.js";import{d as A,f as G,m as H,a as J,b as Q}from"./modulesdev-04ccece5.js";import{v as h,_ as Y}from"./index-32d6febb.js";const C=_=>(O("data-v-fb59f2bb"),_=_(),X(),_),Z={class:"title"},ee={class:"file-box h100"},oe={class:"sys-file file-window h100"},ae={class:"tree-header"},te={class:"sys-file-tip"},le=C(()=>o("span",null,"系统文件",-1)),se={class:"module-file file-window h100"},ne={class:"tree-header"},ie=C(()=>o("span",null,"模块文件",-1)),de={class:"tree-header-btns"},ce={class:"tree-header-btn"},re={class:"tree-header-btn"},pe={class:"custom-tree-node"},_e=L({__name:"file",setup(_){const i=P("baTable"),m=R(),a=W({backupDir:"",loading:{pack:!1,backup:!1},moduleFiles:[],moduleTreeUid:h()}),b=(e,t,n)=>{Q({uid:i.form.extend.uid,type:n,path:e.data.path?e.data.path:""}).then(d=>{n=="root"&&!e.data.path&&(a.backupDir=d.data.backupDir,a.moduleFiles=d.data.moduleFiles,d.data.needBackup&&k()),t(d.data.data)})},z=(e,t)=>b(e,t,"root"),F=(e,t)=>b(e,t,"module"),D=e=>{A({path:e.path}).then(()=>{a.moduleTreeUid=h()})},T=(e,t)=>{const{checkedKeys:n}=t;G({uid:i.form.extend.uid,dir:e.dir?0:1,path:e.path,checked:n.includes(e.path)?1:0}).then(()=>{a.moduleTreeUid=h()})},k=()=>{a.loading.backup=!0,H({uid:i.form.extend.uid}).finally(()=>{a.loading.backup=!1})},B=()=>{a.loading.pack=!0,J({uid:i.form.extend.uid}).then(e=>{window.location.href=e.data.url}).finally(()=>{a.loading.pack=!1})};return(e,t)=>{const n=c("Icon"),d=c("el-popover"),g=c("el-scrollbar"),N=c("el-popconfirm"),I=c("el-button"),M=c("el-dialog"),S=v("drag"),U=v("zoom");return p(),f(M,{class:"ba-operate-dialog","close-on-click-modal":!1,"model-value":r(i).form.extend.showFile,onClose:t[2]||(t[2]=u=>r(i).form.extend.showFile=!1),width:"50%","destroy-on-close":!0},{header:l(()=>[$((p(),E("div",Z,[y("模块文件管理")])),[[S,[".ba-operate-dialog",".el-dialog__header"]],[U,".ba-operate-dialog"]])]),footer:l(()=>[o("div",{style:j("width: calc(100% - "+r(i).form.labelWidth/1.8+"px)")},[s(I,{disabled:a.loading.pack||a.loading.backup,onClick:t[1]||(t[1]=u=>r(i).form.extend.showFile=!1)},{default:l(()=>[y("关闭")]),_:1},8,["disabled"])],4)]),default:l(()=>[o("div",ee,[o("div",oe,[s(g,{class:"ba-table-form-scrollbar"},{default:l(()=>[o("div",ae,[s(d,{placement:"right",width:200,trigger:"hover",content:"勾选目录以复制到模块，系统文件目录【展开】后才能自动选中模块已有文件！"},{reference:l(()=>[o("div",te,[le,s(n,{name:"el-icon-Warning",size:"14"})])]),_:1})]),s(r(w),{ref_key:"treeRef",ref:m,"default-checked-keys":a.moduleFiles,props:{isLeaf:"dir"},load:z,lazy:"","show-checkbox":"","node-key":"path","highlight-current":"",onCheck:T},null,8,["default-checked-keys"])]),_:1})]),o("div",se,[s(g,{class:"ba-table-form-scrollbar"},{default:l(()=>[o("div",ne,[ie,o("div",de,[s(d,{placement:"left",width:200,trigger:"hover",content:"文件的变更立即生效，建议时常备份，备份目录："+a.backupDir+" 初次打开此窗口会自动备份一次"},{reference:l(()=>[o("div",ce,[a.loading.backup?(p(),f(n,{key:0,size:"13",color:"var(--el-color-primary)",name:"el-icon-Loading",class:"loading-icon"})):x("",!0),o("span",{onClick:k},"备份")])]),_:1},8,["content"]),s(d,{placement:"left",width:200,trigger:"hover",content:"点击下载模块包，请注意弹窗是否被拦截"},{reference:l(()=>[o("div",re,[a.loading.pack?(p(),f(n,{key:0,size:"13",color:"var(--el-color-primary)",name:"el-icon-Loading",class:"loading-icon"})):x("",!0),o("span",{onClick:B},"打模块包")])]),_:1})])]),(p(),f(r(w),{key:a.moduleTreeUid,ref_key:"treeRef",ref:m,props:{isLeaf:"dir"},load:F,lazy:"","node-key":"path","highlight-current":""},{default:l(({node:u,data:V})=>[o("span",pe,[o("span",null,q(u.label),1),s(N,{title:"确认删除？",onConfirm:fe=>D(V)},{reference:l(()=>[s(n,{name:"el-icon-DeleteFilled",onClick:t[0]||(t[0]=K(()=>{},["stop"])),size:"13"})]),_:2},1032,["onConfirm"])])]),_:1}))]),_:1})])])]),_:1},8,["model-value"])}}});const be=Y(_e,[["__scopeId","data-v-fb59f2bb"]]);export{be as default};
